worker_processes                auto;
worker_rlimit_core              500M;

events {
    accept_mutex                off;
    worker_connections          1024;
    multi_accept                on;
    use                         epoll;
}


http {
    # --- Buffer Overflow Prevention
    client_body_buffer_size     10k;
    client_header_buffer_size   1k;
    client_max_body_size        8m;
    large_client_header_buffers 4 32k;

    access_log                  off;
    error_log                   /etc/nginx/error_log.log warn;
    proxy_cache_path            /etc/nginx/cache keys_zone=one:500m max_size=1000m;

    include                     security.conf;
    include                     compression.conf;

 # --- Performance Boosting
    # Copies data between file directories from within the kernel (Faster than read() + write())
    sendfile                    on;
    # Send headers in one piece rather than one by one
    tcp_nopush                  on;
    # No buffering data
    tcp_nodelay                 on;

    # --- DDOS Protection
    limit_req_zone              $binary_remote_addr zone=req_limit_per_ip:10m rate=2r/s;
    limit_conn_zone             $binary_remote_addr zone=conn_limit_per_ip:10m;

    # --- Timeout
    reset_timedout_connection   on;
    client_body_timeout         10; # default 60
    send_timeout                5; # default 60
    keepalive_timeout           30; # default 75  
    

    server {
        listen 80 default_server;
        listen [::]:80 default_server;        
        server_name _;
        return 301 https://$host$request_uri;
    }

    #domain
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;
        
        server_name feddema.dev; 

        location / {
            return 404;
        }
    }
    
 #jenkins server
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name jenkins.feddema.dev; 

        location / {
            proxy_pass         http://172.17.0.1:9006;    
            proxy_redirect     http://172.17.0.1:9006 https://jenkins.feddema.dev;
            include            proxy-headers.conf;

        }
    }

    #github domain
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;
        
        server_name github.feddema.dev; 

        location / {
            proxy_pass         https://github.com/FlorisFeddema;
            proxy_redirect     https://github.feddema.dev https://github.com/FlorisFeddema;
            include            proxy-headers.conf;
        }
    }

    #docker registry
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name docker.feddema.dev; 
        
        client_max_body_size        500m;

        location / {
            proxy_pass         http://172.17.0.1:9009;
            proxy_redirect     http://172.17.0.1:9009 https://docker.feddema.dev;
            include            proxy-headers.conf;  
            proxy_set_header   X-Forwarded-Proto https;       
        }
    }

    #jupyter registry
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name jupyter.feddema.dev; 
        
        location / {
            proxy_pass         http://172.17.0.1:9011;
            proxy_redirect     http://172.17.0.1:9011 https://jupyter.feddema.dev;
            include            proxy-headers.conf;  
            proxy_set_header   X-Forwarded-Proto https;       
        }
    }
    
    #portainer
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name portainer.feddema.dev; 
   
        location / {
            proxy_pass         http://172.17.0.1:9010;
            proxy_redirect     http://172.17.0.1:9010 https://portainer.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    #api
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name vastgoed.hize.nl; 

        location / {
            proxy_pass         http://172.17.0.1:10011;
            proxy_redirect     http://172.17.0.1:10011 https://vastgoed.feddema.dev;
            include            proxy-headers.conf;
        }
    }
    
    #sjoncrypt
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name sjoncrypt.feddema.dev; 
        
        location / {
            proxy_pass         http://apps.zo-applicaties.nl:8585/zourenregapp/passgen.php;
            proxy_redirect     http://apps.zo-applicaties.nl:8585/zourenregapp/passgen.php sjoncrypt.feddema.dev; 
            include            proxy-headers.conf;
        }
    }

    #sjondecrypt
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name sjondecrypt.feddema.dev; 
        
        location / {
            proxy_pass         http://apps.zo-applicaties.nl:8585/zourenregapp/passungen.php;
            proxy_redirect     http://apps.zo-applicaties.nl:8585/zourenregapp/passungen.php https://sjondecrypt.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    #frond
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name apivastgoed.hize.nl; 
 
        location / {
            proxy_pass         http://172.17.0.1:10010;
            proxy_redirect     http://172.17.0.1:10010 https://apivastgoed.hize.nl;
            include            proxy-headers.conf;
        }
    }

#sonarqube
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name sonarqube.feddema.dev; 

        location / {
            proxy_pass         http://172.17.0.1:9000;
            proxy_redirect     http://172.17.0.1:9000 https://sonarqube.feddema.dev;
            include            proxy-headers.conf;
        }
    }

#adminer
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name adminer.feddema.dev; 

        location / {
            proxy_pass         http://172.17.0.1:9001;
            proxy_redirect     http://172.17.0.1:9001 https://adminer.feddema.dev;
            include            proxy-headers.conf;
        }
    }

#nextcloud
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name nextcloud.feddema.dev; 
    
        client_max_body_size        30g;

        location / {
            proxy_pass         http://172.17.0.1:9003;
            proxy_redirect     http://172.17.0.1:9003 https://nextcloud.feddema.dev;
            include            proxy-headers.conf;
        }
    }

#glances
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name glances.feddema.dev; 

        location / {
            proxy_pass         http://172.17.0.1:9004;
            proxy_redirect     http://172.17.0.1:9004 https://glances.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    # #webmail server
    # server {
    #     listen 443 ssl http2;
    #     listen [::]:443 ssl http2;

    #     server_name mail.feddema.dev;

    #     location / {
    #         proxy_pass         http://172.17.0.1:9007;
    #         proxy_redirect     off;
    #         proxy_set_header   Host $host;
    #         proxy_set_header   X-Real-IP $remote_addr;
    #         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    #         proxy_set_header   X-Forwarded-Host $server_name;
    #     }
    # }

    #webmail server
    # server {
    #     listen 443 ssl http2;
    #     listen [::]:443 ssl http2;

    #     server_name webmail.feddema.dev;

    #     location / {
    #         proxy_pass         http://172.17.0.1:9007;
    #         proxy_redirect     off;
    #         proxy_set_header   Host $host;
    #         proxy_set_header   X-Real-IP $remote_addr;
    #         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    #         proxy_set_header   X-Forwarded-Host $server_name;
    #     }
    # }

    #php proftaak p1 Niels
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name proftaak.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9012;
            proxy_redirect     http://172.17.0.1:9012 https://proftaak.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    #react app countdown aftermovie
    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name aftermovie.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9999;
            proxy_redirect     http://172.17.0.1:9999 https://aftermovie.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name aftermovieapi.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9998;
            proxy_redirect     http://172.17.0.1:9998 https://aftermovieapi.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name blockchainapi.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:4000;
            proxy_redirect     http://172.17.0.1:4000 https://blockchainapi.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name rancher.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9015;
            proxy_redirect     http://172.17.0.1:9015 https://rancher.feddema.dev;
            include            proxy-headers.conf;

            proxy_http_version                  1.1;
            proxy_set_header Upgrade            $http_upgrade;
            proxy_set_header Connection         "upgrade";

        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name rabbit.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9016;
            proxy_redirect     http://172.17.0.1:9016 https://rabbit.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name mq.feddema.dev;

        location / {
            proxy_pass         http://172.17.0.1:9017;
            proxy_redirect     http://172.17.0.1:9017 https://mq.feddema.dev;
            include            proxy-headers.conf;
        }
    }

    server {
        listen 443 ssl http2;
        listen [::]:443 ssl http2;

        server_name hize.nl;

        location / {
            proxy_pass         http://172.17.0.1:9018;
            proxy_redirect     http://172.17.0.1:9018 https://hize.nl;
            include            proxy-headers.conf;
        }
    }
}
